@model IEnumerable<TrabajoAutomotriza.Models.Factura>

@{ 
    ViewBag.Title = "Servicio de Pago";
}

<h2>@ViewBag.Title</h2>

<div class="container">
    <div class="row">
        <div class="col-md-8">
            <h3>Caja - Facturas Pendientes</h3>
            <div class="list-group">
                @foreach (var item in Model)
                {
                    <a href="#" class="list-group-item list-group-item-action" data-factura-id="@item.idFactura">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">FACTURA #@item.idFactura</h5>
                            <small>@item.fechaFactura.ToShortDateString()</small>
                        </div>
                        <p class="mb-1">@item.Presupuesto.OrdenMantenimiento.Auto.marca @item.Presupuesto.OrdenMantenimiento.Auto.modelo (@item.Presupuesto.OrdenMantenimiento.Auto.placa)</p>
                        <small>Total: S/@item.totalFactura</small>
                    </a>
                }
            </div>
        </div>
        <div class="col-md-4">
            <h3>Procesar Pago</h3>
            <div class="card">
                <div class="card-body">
                    @using (Html.BeginForm("ProcesarPago", "Pagos", FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()
                        <input type="hidden" id="facturaId" name="facturaId" />
                        <div class="form-group">
                            <label for="monto">Monto a Pagar</label>
                            <input type="text" class="form-control" id="monto" name="monto" readonly />
                        </div>
                        <div class="form-group">
                            <label>MÃ©todo de pago</label>
                            <p class="form-control-plaintext"><strong>Efectivo</strong></p>
                            <input type="hidden" name="metodoPago" value="Efectivo" />
                        </div>
                        <button type="submit" class="btn btn-primary">Procesar Pago</button>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.list-group-item').on('click', function (e) {
                e.preventDefault();
                var facturaId = $(this).data('factura-id');
                var total = $(this).find('small').text().replace('Total: S/', '');
                $('#facturaId').val(facturaId);
                $('#monto').val(total);
            });
        });
    </script>
}
